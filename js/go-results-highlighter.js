!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GoResultsHighlighter=t():e.GoResultsHighlighter=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r={prefixCls:"go-results-",rearrangedCls:"rearranged",tableCls:"table",gameCls:"game",currentCls:"current",results:{won:"([0-9]+)\\+",lost:"([0-9]+)\\-",jigo:"([0-9]+)=",unresolved:"([0-9]+)\\?"},startingRow:0,placeColumn:0,roundsColumns:null,rowTags:"tr",cellTags:"td",ignoreOutOfBoundsRows:!1,checkColumnsForResults:!0,cellSeparator:"[\t ]+",joinNames:!0,hovering:!0,rearranging:!0},i=["rearrangedCls","tableCls","gameCls","currentCls"],s="data-go-results",o="data-go-starting-row",a="data-go-place-column",l="data-go-rounds-columns",u="data-go-rearranging",g="data-go-hovering",c="data-go-place",f="data-go-opponent",h="data-go-opponents",p="data-go-result";function m(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({cls:n,regexp:new RegExp(e[n])});return t}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e){return Array.prototype.slice.call(e)}function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.filter((function(e){return"object"===d(e)})).reverse(),s=i.length,o={};e:for(var a in e){for(var l=0;l<s;l++)if(i[l].hasOwnProperty(a)){o[a]=i[l][a];continue e}o[a]=e[a]}return o}function y(e,t){e.setAttribute(c,t)}function C(e){return function(t,n){return-1!==e.indexOf(n)}}function w(e,t){var n,i,s=b(r,t),o=m(s.results),a=o.length,l=function(e,t){for(var n=e.querySelectorAll(t.rowTags),r=new Array(n.length),i=0;i<n.length;i++){var s=n[i],o=s.querySelectorAll(t.cellTags);r[i]={row:s,cells:v(o)}}return r}(e,s),u=function(e,t,n){return"string"==typeof t.roundsColumns?C(t.roundsColumns.split(",").map(Number)):t.checkColumnsForResults?C(function(e,t){return function(e){for(var t=[],n=0;n<e.length;n++)for(var r=0;r<e[n].cells.length;r++)t[r]||(t[r]=[]),t[r][n]=e[n].cells[r].textContent;return t}(e).reduce((function(e,n,r){return function(e,t){var n=e.length;return function(e,t){return e.filter((function(e){return t.some((function(t){return e.match(t.regexp)}))}))}(e,t).length/n>=.4}(n,t)&&e.push(r),e}),[])}(e,n)):function(){return!0}}(l,s,o),g={};return l.forEach((function(e,t){var r=e.row,h=e.cells;if(t<s.startingRow)return;var m=-1;if(!h.length||!h[s.placeColumn])return void y(r,m);var d=parseInt(h[s.placeColumn].textContent,10),v={tournamentPlace:-1,row:r,games:{},opponents:[]};if(r.hasAttribute(c))m=Number(r.getAttribute(c));else{if(i)m=i+1;else{if(isNaN(d))return void y(r,m);m=d||1}d?d<=n&&(d=n):d=n||1,y(r,m)}if(-1===Number(m))return;h.forEach((function(e,t){u(e,t)&&function(e,t){var n,r;if(t.hasAttribute(p)&&t.hasAttribute(f))n=Number(t.getAttribute(f)),r=t.getAttribute(p);else{for(var i=0;i<a;i++){var u=t.textContent.match(o[i].regexp);if(u){if(n=Number(u[1]),r=o[i].cls,n<=0||!s.ignoreOutOfBoundsRows&&n>l.length)return;t.setAttribute(f,n),t.setAttribute(p,o[i].cls)}}if(!n)return}e.games[n]={cell:t,cls:r},e.opponents.push(n)}(v,e)})),v.tournamentPlace=d,v.index=t,v.opponents.sort((function(e,t){return e>t?1:-1})),g[m]=v,n=d,i=m})),g}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=b(r,function(e){var t={};return e.hasAttribute(a)&&(t.placeColumn=Number(e.getAttribute(a))),e.hasAttribute(o)&&(t.startingRow=Number(e.getAttribute(o))),e.hasAttribute(l)&&(t.roundsColumns=e.getAttribute(l)),e.hasAttribute(u)&&(t.rearranging="false"!==e.getAttribute(u)),e.hasAttribute(g)&&(t.hovering="false"!==e.getAttribute(g)),t}(t),n),t instanceof HTMLPreElement){var i=function(e,t){var n=document.createElement("table");if(!e)return n;var i=b(r,t),o=e.replace(/<br[^>]*>/gi,"\n").replace(/<\/?code[^>]*>/gi,"").split(/\r\n|\n/);if(o.length<=2&&!o[0]&&!o[1])return n;var a,l=m(i.results),u=l.length,g=o.map((function(e){return e.replace(/([0-9]+)\s(dan|kyu)/i,"$1_$2").split(new RegExp(i.cellSeparator)).filter((function(e){return e.length>0}))})).filter((function(e){return e.length>0&&0!==e[0].indexOf(";")})),d=g.reduce((function(e,t){return Math.max(e,t.length)}),0),v=i.joinNames?-1:0,y=i.placeColumn+1,C=null;return"string"==typeof i.roundsColumns&&(C=i.roundsColumns.split(",").map(Number)),g.forEach((function(e,t){var r=document.createElement("tr"),s=e.length;if(s){if(t<i.startingRow||s<d+v){var o=document.createElement("td");o.setAttribute("colspan",d+v),o.textContent=e.join(" "),r.setAttribute(c,-1),r.appendChild(o)}else{var g=parseInt(e[i.placeColumn],10);if(isNaN(g)&&!a)e.forEach((function(e){var t=document.createElement("td");t.textContent=e,r.setAttribute(c,-1),r.appendChild(t)}));else{r.setAttribute(c,a||g);var m=[];i.joinNames&&e.splice(y,2,"".concat(e[y],"  ").concat(e[y+1])),e.forEach((function(e,t){var n=document.createElement("td");if(n.textContent=e.replace(/_/," "),!C||C.indexOf(t)>=0)for(var i=0;i<u;i++){var s=e.match(l[i].regexp);if(s){var o=s[1];m.push(o),n.setAttribute(f,o),n.setAttribute(p,l[i].cls)}}r.appendChild(n)})),m.length&&r.setAttribute(h,m.join(",")),a?a+=1:a=2}}n.appendChild(r)}})),n.setAttribute(s,""),n}(t.innerHTML,n),d=t.parentNode;d.insertBefore(i,t),d.removeChild(t),this.element=i}else this.element=t;this.element.classList&&(this.createPlayersMap(),this.bindEvents(),this.element.classList.add(this.settings.prefixCls+this.settings.tableCls),this.current=null,this.games=[],this.isRearranged=!1,this.isHighlighting=!1)}var t,n,d;return t=e,(n=[{key:"createPlayersMap",value:function(){for(var e in this.map=w(this.element,this.settings),this.players=[],this.map)this.map.hasOwnProperty(e)&&this.players.push(this.map[e])}},{key:"highlight",value:function(e){var t=this;e||(e={});var n=e.player,r=!0===e.rearrange,s=e.games,o=this.map[n],a=function(e){var t={};return i.forEach((function(n){t[n]=e.prefixCls+e[n]})),t}(this.settings);this.isRearranged&&this.players.forEach((function(e){var t=e.row.parentNode.children[e.index];t!==e.row&&e.row.parentNode.insertBefore(e.row,t),e.rearranged=!1})),o&&r?(function(e,t){for(var n=e.row.parentNode,r=e.row.nextElementSibling,i=0;i<t.length;i++){var s=t[i];s.index<e.index?n.insertBefore(s.row,e.row):(n.insertBefore(s.row,r),r=s.row.nextElementSibling),s.rearranged=!0}}(o,o.opponents.map((function(e){return t.map[e]}))),this.element.classList.add(a.rearrangedCls),this.isRearranged=!0):(this.element.classList.remove(a.rearrangedCls),this.isRearranged=!1);var l=v(this.element.querySelectorAll("."+a.gameCls)),u=this.element.querySelector("."+a.currentCls),g=u?u.getAttribute(c):null,f=g?this.map[g]:null,h=function(e,n){var r=n?"add":"remove";e.row.classList[r](a.currentCls),e.opponents.forEach((function(n){t.map[n].row.classList[r](t.settings.prefixCls+e.games[n].cls)}))};l.forEach((function(e){e.classList.remove(a.gameCls)})),f&&f!==o&&h(f,!1),o&&o!==f&&h(o,!0),this.games.length=0,o?("number"==typeof s&&(s=[s]),s&&"number"==typeof s.length?s.forEach((function(e){var r=t.map[e],i=o.games[e];r&&i&&(i.cell.classList.add(a.gameCls),r.games[n].cell.classList.add(a.gameCls),t.games.push(e))})):this.isRearranged&&o.opponents.forEach((function(e){t.map[e].games[n].cell.classList.add(a.gameCls),t.games.push(e)})),this.current=n,this.isHighlighting=!0):(this.current=null,this.isHighlighting=!1)}},{key:"configure",value:function(e){this.highlight(null),this.element.classList.remove(this.settings.prefixCls+this.settings.tableCls),this.settings=b(this.settings,e),this.createPlayersMap(),this.element.classList.add(this.settings.prefixCls+this.settings.tableCls)}},{key:"bindEvents",value:function(){var e=this,t=!1;this.element.addEventListener("touchstart",(function(){t=!1})),this.element.addEventListener("touchmove",(function(){t=!0})),this.element.addEventListener("touchend",(function(n){if(!(t||!1===e.settings.rearranging&&!1===e.settings.hovering)){var r=E(n.target),i=r.target,s=r.player,o=r.games;if(s){var a,l=!1;e.current===s?(e.settings.rearranging&&e.settings.hovering||(s=null),l=!e.isRearranged):!e.isRearranged&&e.settings.hovering||(l=!0),l&&(a=i.getBoundingClientRect().top),e.highlight({player:s,games:o,rearrange:l}),a&&A(i,a),n.preventDefault()}}})),this.element.addEventListener("click",(function(t){if(!1!==e.settings.rearranging){var n,r=E(t.target),i=r.target,s=r.player,o=r.games,a=!1;s&&(!e.isRearranged||e.map[s]&&e.map[s].rearranged?a=!0:e.settings.hovering||(s=null),n=i.getBoundingClientRect().top,e.highlight({player:s,games:o,rearrange:a}),n&&A(i,n))}})),this.element.addEventListener("mouseover",(function(t){if(!1!==e.settings.hovering){var n=E(t.target),r=n.player,i=n.games,s=e.isRearranged;if(r){if(e.isRearranged){if((!i||r!==e.current)&&e.games.length===e.map[e.current].opponents.length)return;r!==e.current&&(r=e.current,i=null)}e.highlight({player:r,rearrange:s,games:i})}}}),!1),this.element.addEventListener("mouseout",(function(t){if(!1!==e.settings.hovering){for(var n=t.relatedTarget;n&&n!==document&&n!==e.element;)n=n.parentNode;n!==e.element&&(e.isRearranged&&e.games.length!==e.map[e.current].opponents.length?e.highlight({player:e.current,rearrange:!0}):e.isRearranged||e.highlight(null))}}),!1)}},{key:"clearInlineStyles",value:function(){this.players.forEach((function(e){v(e.row.childNodes).forEach((function(e){return e.removeAttribute("style")}))}))}}])&&R(t.prototype,n),d&&R(t,d),e}();function A(e,t){var n=e.getBoundingClientRect().top-t;Math.abs(n)>10&&window.scrollBy(0,n)}function E(e){for(var t={player:null,games:null,target:null};e&&e!==document;){var n=e.getAttribute(f),r=e.getAttribute(c);if(n&&(t.games=Number(n)),r){t.player=Number(r);break}e=e.parentNode}return t.target=e,t}function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e){return{get:e,enumerable:!0,configurable:!1}}x.DEFAULT_SETTINGS=r;var O=function e(t,n){if(!(this instanceof e))return new e(t,n);var r=new x(t,n);this.highlight=function(e,t,n){"object"===S(e)?r.highlight(e):("boolean"==typeof t&&(n=t,t=null),r.highlight({player:e,rearrange:n,games:t}))},this.configure=function(e){r.configure(e)},this.opponents=function(e){var t=r.map[e];return t?t.opponents.slice():[]},this.clearInlineStyles=function(){r.clearInlineStyles()},Object.defineProperties(this,{element:N((function(){return r.element})),isHighlighting:N((function(){return r.isHighlighting})),isRearranged:N((function(){return r.isRearranged})),player:N((function(){return r.current||null})),players:N((function(){return r.players.length})),games:N((function(){return r.games})),configuration:N((function(){var e=r.settings.results,t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return{startingRow:r.settings.startingRow,placeColumn:r.settings.placeColumn,roundsColumns:r.settings.roundsColumns,prefixCls:r.settings.prefixCls,rearrangedCls:r.settings.rearrangedCls,tableCls:r.settings.tableCls,gameCls:r.settings.gameCls,currentCls:r.settings.currentCls,rowTags:r.settings.rowTags,cellTags:r.settings.cellTags,cellSeparator:r.settings.cellSeparator,joinNames:r.settings.joinNames,ignoreOutOfBoundsRows:r.settings.ignoreOutOfBoundsRows,checkColumnsForResults:r.settings.checkColumnsForResults,results:t}})),rearranging:{set:function(e){!e&&r.isRearranged&&r.highlight(null),r.settings.rearranging=!!e},get:function(){return r.settings.rearranging},configurable:!1,enumerable:!0},hovering:{set:function(e){return r.settings.hovering=!!e},get:function(){return r.settings.hovering},configurable:!1,enumerable:!0}}),r.element.goResultsHighlighter=this},j="[".concat(s,"]");n(0),t.default=O;"undefined"!=typeof jQuery?function(e){e.fn.goResultsHighlighter=function(t){return this.each((function(n,r){var i=new O(r,t);e(i.element).data("GoResultsHighlighter",i)})),this},e((function(){e(j).goResultsHighlighter()}))}(jQuery):document&&function(e){function t(){v(e.querySelectorAll(j)).forEach((function(e){return new O(e)}))}"complete"===e.readyState?t():e.addEventListener("DOMContentLoaded",t,!1)}(document)}]).default}));